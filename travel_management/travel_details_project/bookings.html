<!DOCTYPE html>
<html lang="en">
  <nav class="navbar">
  <div class="logo">Travel Explorer</div>
  <ul class="nav-links">
    <li><a href="index.html">Home</a></li>
    <li><a href="register.html">Register</a></li>
    <li><a href="dashboard.html">Dashboard</a></li>
    <li><a href="bookings.html">Bookings</a></li>
  </ul>
</nav>

<head>
  <meta charset="UTF-8" />
  <title>Your Bookings - Travel Explorer</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    /* üåç Background */
    body.bg {
      background: url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e') no-repeat center center/cover;
      min-height: 100vh;
      font-family: "Poppins", sans-serif;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 10px;
    }

    /* üßä Glassmorphism container */
    .container {
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 30px;
      width: 90%;
      max-width: 1000px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      font-size: 2rem;
      color: #ffd166;
      letter-spacing: 1px;
    }

    /* üìã Table styling */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      border-radius: 10px;
      overflow: hidden;
    }

    th, td {
      padding: 12px;
      text-align: center;
      border-bottom: 1px solid rgba(255,255,255,0.2);
    }

    th {
      background: rgba(255, 179, 71, 0.95);
      color: #000;
      font-weight: bold;
    }

    td {
      background: rgba(255, 255, 255, 0.05);
      color: #f0f0f0;
      transition: background 0.3s ease;
    }

    tr:nth-child(even) td {
      background: rgba(255, 255, 255, 0.08);
    }

    tr:hover td {
      background: rgba(255, 255, 255, 0.15);
    }

    tr.editing td {
      background-color: rgba(0, 191, 255, 0.25) !important;
    }

    /* ‚úèÔ∏è Buttons */
    button {
      margin: 0 5px;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: transform 0.2s ease, background 0.3s ease;
    }

    .edit-btn { background: #00bfff; color: #fff; }
    .delete-btn { background: #ff4d4d; color: #fff; }
    .save-btn { background: #4CAF50; color: #fff; }
    .cancel-btn { background: #f44336; color: #fff; }

    .edit-btn:hover { background: #1e90ff; transform: scale(1.05); }
    .delete-btn:hover { background: #ff0000; transform: scale(1.05); }
    .save-btn:hover { background: #45a049; transform: scale(1.05); }
    .cancel-btn:hover { background: #d32f2f; transform: scale(1.05); }

    /* üìù Inputs inside table */
    input {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 5px;
      padding: 6px 8px;
      width: 90%;
      text-align: center;
      color: #000;
      font-weight: 500;
    }

    input:focus {
      outline: 2px solid #ffb347;
      background: #fff;
    }

    /* üîô Back button */
    .back-btn {
      display: block;
      margin: 25px auto 0;
      background: #ffd166;
      color: #000;
      padding: 10px 20px;
      border-radius: 8px;
      font-weight: bold;
      transition: 0.3s ease;
    }

    .back-btn:hover {
      background: #ffb347;
      transform: translateY(-2px);
    }

    /* üì± Responsive */
    @media (max-width: 768px) {
      table, th, td {
        font-size: 14px;
        padding: 8px;
      }
      .container { padding: 20px; }
    }
  </style>

</head>


<body class="bg">
  <div class="container">
    <h1>Your Bookings</h1>
    <div id="bookingList"></div>
    <button class="back-btn" onclick="goBack()">‚Üê Back to Dashboard</button>
  </div>

  <script>
    if (window.location.pathname.endsWith("bookings.html")) displayBookings();

    function formatForDisplay(dateStr) {
      const d = new Date(dateStr);
      const day = String(d.getDate()).padStart(2,'0');
      const month = String(d.getMonth()+1).padStart(2,'0');
      const year = d.getFullYear();
      return `${day}/${month}/${year}`;
    }

    async function displayBookings() {
      const bookingList = document.getElementById("bookingList");
      bookingList.innerHTML = "Loading...";
      const loggedUser = JSON.parse(localStorage.getItem("loggedInUser"));

      try {
        const res = await fetch(`http://localhost:5000/api/bookings/${loggedUser.id}`);
        const bookings = await res.json();

        if(bookings.length === 0) {
          bookingList.innerHTML = "<p>No bookings yet!</p>";
          return;
        }

        let table = "<table><tr><th>ID</th><th>Destination</th><th>Date</th><th>Days</th><th>Hotel</th><th>Actions</th></tr>";
        bookings.forEach(b => {
          table += `<tr data-id="${b.id}">
                      <td>${b.id}</td>
                      <td class="dest">${b.destination}</td>
                      <td class="date" data-iso="${b.travel_date}">${formatForDisplay(b.travel_date)}</td>
                      <td class="days">${b.days}</td>
                      <td class="hotel">${b.hotel}</td>
                      <td class="actions">
                        <button class="edit-btn" onclick="enableEdit(this)">Edit</button>
                        <button class="delete-btn" onclick="deleteBooking(${b.id})">Delete</button>
                      </td>
                    </tr>`;
        });
        table += "</table>";
        bookingList.innerHTML = table;

      } catch(err) {
        console.error(err);
        bookingList.innerHTML = "<p>Error fetching bookings.</p>";
      }
    }

    function enableEdit(button) {
      const row = button.closest("tr");
      const id = row.dataset.id;
      row.classList.add("editing");

      const oldDest = row.querySelector(".dest").innerText;
      const oldDate = row.querySelector(".date").dataset.iso;
      const oldDays = row.querySelector(".days").innerText;
      const oldHotel = row.querySelector(".hotel").innerText;

      row.querySelector(".dest").innerHTML = `<input type="text" value="${oldDest}" />`;
      row.querySelector(".date").innerHTML = `<input type="date" value="${new Date(oldDate).toISOString().slice(0,10)}" />`;
      row.querySelector(".days").innerHTML = `<input type="number" min="1" value="${oldDays}" />`;
      row.querySelector(".hotel").innerHTML = `<input type="text" value="${oldHotel}" />`;

      const actionsCell = row.querySelector(".actions");
      actionsCell.innerHTML = `
        <button class="save-btn">Save</button>
        <button class="cancel-btn">Cancel</button>
      `;

      actionsCell.querySelector(".save-btn").onclick = async function() {
        const newDest = row.querySelector(".dest input").value.trim();
        const newDate = row.querySelector(".date input").value;
        const newDays = row.querySelector(".days input").value;
        const newHotel = row.querySelector(".hotel input").value.trim();

        if(!newDest || !newDate || !newDays || !newHotel) {
          alert("All fields are required!");
          return;
        }

        try {
          const res = await fetch(`http://localhost:5000/api/bookings/${id}`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ destination: newDest, travel_date: newDate, days: newDays, hotel: newHotel })
          });
          if(res.ok) displayBookings();
          else alert("Failed to update booking!");
        } catch(err) {
          console.error(err);
          alert("Server error!");
        }
      };

      actionsCell.querySelector(".cancel-btn").onclick = function() {
        row.querySelector(".dest").innerText = oldDest;
        row.querySelector(".date").innerText = formatForDisplay(oldDate);
        row.querySelector(".days").innerText = oldDays;
        row.querySelector(".hotel").innerText = oldHotel;

        actionsCell.innerHTML = `
          <button class="edit-btn" onclick="enableEdit(this)">Edit</button>
          <button class="delete-btn" onclick="deleteBooking(${id})">Delete</button>
        `;
        row.classList.remove("editing");
      };
    }

    async function deleteBooking(id) {
      if(!confirm("Are you sure you want to delete this booking?")) return;
      try {
        const res = await fetch(`http://localhost:5000/api/bookings/${id}`, { method: "DELETE" });
        if(res.ok) displayBookings();
        else alert("Failed to delete booking!");
      } catch(err) {
        console.error(err);
        alert("Server error!");
      }
    }

    function goBack() { window.location.href = "dashboard.html"; }
  </script>
</body>
</html>
